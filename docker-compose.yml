services:
  web:
    build:
      context: .
      args:
        # Provide these via an .env file or your shell env
        VITE_SUPABASE_URL: ${VITE_SUPABASE_URL}
        VITE_SUPABASE_ANON_KEY: ${VITE_SUPABASE_ANON_KEY}
    ports:
      - "8081:80"
    environment:
      NODE_ENV: production
    # Uncomment if you want to mount a local build (dev only)
    # volumes:
    #   - ./dist:/usr/share/nginx/html:ro

  server:
    build:
      context: ./server
    environment:
      PORT: 8080
      ORIGIN: http://localhost:8081
      JWT_SECRET: ${JWT_SECRET:-dev-change-me}
      NODE_ENV: production
    ports:
      - "8080:8080"
    volumes:
      - ./server/data:/app/server/data
      - ./server/uploads:/app/server/uploads
    depends_on:
      - web
