import{i as s,b as a,s as l}from"./index-wTsEScI4.js";async function _(){if(s())try{const r=await a("/profiles/me");return r?.id||r?.user_id||null}catch{return null}const{data:e}=await l.auth.getUser();return e.user?.id||null}async function $(e){if(s())try{return{data:await a(`/follows/relation/${e}`),error:null}}catch(o){return{data:null,error:o}}const r=await _();return r?l.from("follows").select("follower_id, followed_id, status, created_at, accepted_at").or(`and(follower_id.eq.${r},followed_id.eq.${e}),and(follower_id.eq.${e},followed_id.eq.${r})`).maybeSingle():{data:null,error:new Error("No autenticado")}}async function N(e){if(s())try{return await a("/follows/follow",{method:"POST",body:JSON.stringify({targetId:e})}),{error:null}}catch(f){return{error:f}}const r=await _();if(!r)return{error:new Error("No autenticado")};if(r===e)return{error:new Error("No puedes seguirte a ti mismo")};const{data:o}=await l.from("follows").select("status").eq("follower_id",r).eq("followed_id",e).maybeSingle();if(o){if(o.status==="pending")return{error:new Error("Ya tienes una solicitud pendiente")};if(o.status==="accepted")return{error:new Error("Ya sigues a este usuario")};if(o.status==="blocked")return{error:new Error("No puedes seguir a este usuario")}}const{error:i}=await l.from("follows").insert({follower_id:r,followed_id:e});return{error:i}}async function E(e){if(s())try{return await a(`/follows/${e}`,{method:"DELETE"}),{error:null}}catch(o){return{error:o}}const r=await _();return r?l.from("follows").delete().eq("follower_id",r).eq("followed_id",e):{error:new Error("No autenticado")}}async function S(e){return E(e)}async function F(e){if(s())try{return await a(`/follows/${e}/accept`,{method:"POST"}),{error:null}}catch(o){return{error:o}}const r=await _();return r?l.from("follows").update({status:"accepted",accepted_at:new Date().toISOString()}).eq("followed_id",r).eq("follower_id",e).eq("status","pending"):{error:new Error("No autenticado")}}async function O(e){if(s())try{return await a(`/follows/${e}/reject`,{method:"DELETE"}),{error:null}}catch(o){return{error:o}}const r=await _();return r?l.from("follows").delete().eq("followed_id",r).eq("follower_id",e).eq("status","pending"):{error:new Error("No autenticado")}}async function R(e){if(s())try{return{data:await a(`/follows/followers?userId=${encodeURIComponent(e)}`),error:null}}catch(r){return{data:null,error:r}}return l.from("follows").select("follower_id, created_at").eq("followed_id",e).eq("status","accepted").order("created_at",{ascending:!1})}async function C(e){if(s())try{return{data:await a(`/follows/following?userId=${encodeURIComponent(e)}`),error:null}}catch(r){return{data:null,error:r}}return l.from("follows").select("followed_id, created_at").eq("follower_id",e).eq("status","accepted").order("created_at",{ascending:!1})}async function P(){if(s())try{if(!await _())return{data:[],error:new Error("No autenticado")};const m=await a("/follows/pending"),t=m.map(c=>c.follower_id);if(t.length===0)return{data:[],error:null};const u=await a("/profiles/batch",{method:"POST",body:JSON.stringify({ids:t})});return{data:m.map(c=>({follower_id:c.follower_id,created_at:c.created_at,follower:u.find(h=>h.user_id===c.follower_id)||null})),error:null}}catch(n){return{data:[],error:n}}const e=await _();if(!e)return{data:[],error:new Error("No autenticado")};const{data:r,error:o}=await l.from("follows").select("follower_id, created_at").eq("followed_id",e).eq("status","pending").order("created_at",{ascending:!1});if(o||!r)return{data:[],error:o};const i=r.map(n=>n.follower_id);if(i.length===0)return{data:[],error:null};const{data:f,error:w}=await l.from("profiles").select("user_id, nombre_completo, avatar_url, username").in("user_id",i);return w?{data:[],error:w}:{data:r.map(n=>({follower_id:n.follower_id,created_at:n.created_at,follower:f?.find(m=>m.user_id===n.follower_id)||null})),error:null}}async function T(e){if(s())try{return{count:(await a(`/follows/followers?userId=${encodeURIComponent(e)}`))?.length||0}}catch{return{count:0}}return l.from("follows").select("follower_id",{count:"exact",head:!0}).eq("followed_id",e).eq("status","accepted")}async function x(e){if(s())try{return{count:(await a(`/follows/following?userId=${encodeURIComponent(e)}`))?.length||0}}catch{return{count:0}}return l.from("follows").select("followed_id",{count:"exact",head:!0}).eq("follower_id",e).eq("status","accepted")}async function I(e,r=0,o=49){if(s())try{const u=(await a(`/follows/followers?userId=${encodeURIComponent(e)}`)).slice(r,o+1),p=u.map(g=>g.follower_id),c=p.length?await a("/profiles/batch",{method:"POST",body:JSON.stringify({ids:p})}):[];return{data:u.map(g=>({follower_id:g.follower_id,created_at:g.created_at,follower:c.find(d=>d.user_id===g.follower_id)||null})),error:null}}catch(t){return{data:[],error:t}}const{data:i,error:f}=await l.from("follows").select("follower_id, created_at").eq("followed_id",e).eq("status","accepted").order("created_at",{ascending:!1}).range(r,o);if(f||!i)return{data:[],error:f};const w=i.map(t=>t.follower_id);if(w.length===0)return{data:[],error:null};const{data:y,error:n}=await l.from("profiles").select("user_id, nombre_completo, avatar_url, username").in("user_id",w);return n?{data:[],error:n}:{data:i.map(t=>({follower_id:t.follower_id,created_at:t.created_at,follower:y?.find(u=>u.user_id===t.follower_id)||null})),error:null}}async function J(e,r=0,o=49){if(s())try{const p=(await a(`/follows/following?userId=${encodeURIComponent(e)}`)).map(d=>({followed_id:d.following_id||d.followed_id,created_at:d.created_at})).slice(r,o+1),c=p.map(d=>d.followed_id),h=c.length?await a("/profiles/batch",{method:"POST",body:JSON.stringify({ids:c})}):[];return{data:p.map(d=>({followed_id:d.followed_id,created_at:d.created_at,followed:h.find(q=>q.user_id===d.followed_id)||null})),error:null}}catch(t){return{data:[],error:t}}const{data:i,error:f}=await l.from("follows").select("followed_id, created_at").eq("follower_id",e).eq("status","accepted").order("created_at",{ascending:!1}).range(r,o);if(f||!i)return{data:[],error:f};const w=i.map(t=>t.followed_id);if(w.length===0)return{data:[],error:null};const{data:y,error:n}=await l.from("profiles").select("user_id, nombre_completo, avatar_url, username").in("user_id",w);return n?{data:[],error:n}:{data:i.map(t=>({followed_id:t.followed_id,created_at:t.created_at,followed:y?.find(u=>u.user_id===t.followed_id)||null})),error:null}}export{T as a,x as b,I as c,J as d,F as e,$ as f,P as g,N as h,S as i,C as j,R as k,O as r,E as u};
